<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel = "stylesheet" href = "http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
    <title>Main Page</title>
    <style>
     .navbar .nav-link.r {
          color: #4e8fcc; background-color: #d7e1f3
        }

    </style>
</head>

<body>
{% include "navbar.html" %}
<div class="container mt-4">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="alert alert-{{ messages[0][0] }} mt-3">
                {{ messages[0][1] }}
            </div>
        {% endif %}
    {% endwith %}
</div>
<div  class="container-fluid" style="padding-right: 10%; padding-left: 10%; padding-top: 20px">
<form id = "reportForm" class ="border rounded p-3" method="POST" action="{{ url_for('report.create_report') }}" enctype="multipart/form-data">
    <div class="mb-3">
      <label for="location" class="form-label">Your coordinates</label>
      <input type="text" id="location" name="location" class="form-control" placeholder="Enter your location or use current location">
    </div>
    <div class="form-check-sm">
      <input class="form-check-input-sm" type="checkbox" id="useCurrentLocation" onclick="toggleLocation()">
      <label class="form-check-label" for="useCurrentLocation">
        Use My Current Location
      </label>
    </div>
    <br>
    <div class="mb-3">
  <label for="description" class="form-label">What happened?</label>
  <textarea class="form-control" id="description" name="description" rows="3"></textarea>
</div><div class="mb-3">
  <label for="photo" class="form-label">Photos of an accident</label>
  <input class="form-control" type="file" id="photo" name="photo">
</div>
  <button type="submit" class="btn btn-dark d-block mx-auto">Send a report</button>
</form>
</div>
</body>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<script>
  function toggleLocation() {
    const locationField = document.getElementById("location");
    const useCurrentLocation = document.getElementById("useCurrentLocation").checked;

    if (useCurrentLocation) {

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            locationField.value = `${position.coords.latitude},${position.coords.longitude}`;
            locationField.readOnly = true;
          },
          (error) => showError(error)
        );
      } else {
        alert("Geolocation is not supported by this browser.");
      }
    } else {
      locationField.value = "";
      locationField.readOnly = false;
    }
  }

  function showError(error) {
    switch (error.code) {
      case error.PERMISSION_DENIED:
        alert("Permission denied. Please enable location access or enter your location manually.");
        break;
      case error.POSITION_UNAVAILABLE:
        alert("Location information is unavailable.");
        break;
      case error.TIMEOUT:
        alert("The request to get user location timed out.");
        break;
      case error.UNKNOWN_ERROR:
        alert("An unknown error occurred.");
        break;
    }
  }
</script>

</html>
